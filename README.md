# 勉強用進捗管理アプリ

Flutterで作っている勉強用進捗管理アプリです。

## Supabaseセットアップ

supabaseでdbとstorageをセットアップします。

```sql
-- Database
create table books (
    id bigint generated by default as identity primary key,
    title text not null,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    amount integer default 100,
    working boolean default true,
    unit_name text not null,
    user_id uuid references auth.users on delete cascade not null,
    image_url text
);

alter table books enable row level security;
create policy "Individuals can create books." on books for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own books. " on books for
    select using (auth.uid() = user_id);
create policy "Individuals can update their own books." on books for
    update using (auth.uid() = user_id);
create policy "Individuals can delete their own books." on books for
    delete using (auth.uid() = user_id);

create table sections (
    id bigint generated by default as identity primary key,
    number integer,
    name text,
    amount integer not null,
    book_id bigint references books on delete cascade not null,
    user_id uuid references auth.users on delete cascade not null
);

alter table sections enable row level security;
create policy "Individuals can create sections." on sections for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own sections. " on sections for
    select using (auth.uid() = user_id);
create policy "Individuals can update their own sections." on sections for
    update using (auth.uid() = user_id);
create policy "Individuals can delete their own sections." on sections for
    delete using (auth.uid() = user_id);


create table records (
    id bigint generated by default as identity primary key,
    start integer not null,
    last integer not null,
    duration integer not null,
    recorded_at timestamp with time zone default timezone('utc'::text, now()) not null,
    started_at timestamp with time zone default timezone('utc'::text, now()) not null,
    book_id bigint references books on delete cascade not null,
    user_id uuid references auth.users on delete cascade not null
);

alter table records enable row level security;
create policy "Individuals can create records." on records for
    insert with check (auth.uid() = user_id);
create policy "Individuals can view their own records. " on records for
    select using (auth.uid() = user_id);
create policy "Individuals can update their own records." on records for
    update using (auth.uid() = user_id);
create policy "Individuals can delete their own records." on records for
    delete using (auth.uid() = user_id);


-- Storage
insert into storage.buckets (id, name)
  values ('bookimages', 'bookimages');

create policy "Book images are publicly accessible." on storage.objects
  for select using (bucket_id = 'bookimages');

create policy "Anyone can upload an image." on storage.objects
  for insert with check (bucket_id = 'bookimages');

create policy "Anyone can update their own book image." on storage.objects
  for update using (auth.uid() = owner) with check (bucket_id = 'bookimages');
```
